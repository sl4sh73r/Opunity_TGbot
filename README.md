# Opunity_TGbot

Немного про структуру бота:

1. Пакет handlers содержит три файла: general.py, client.py, seller.py - 
это все необходимые обработчики сообщений для каждого типа пользователя - 
либо заказчика, либо исполнителя. Хэндлеры работают благодаря конечным автоматам
FSM, которые прописаны в файле states.py
Некоторые хэндлеры являются callback-ами, они вызываются, когда пользователь нажимает
на какую-нибудь кнопку. Пример callback-а: make_order() в client.py и welcome_seller()
в seller.py

2. Пакет keyboards содержит два файла: inline.py и reply.py - это файлы, каждый из которых
содержит свой тип кнопок и клавиатур. Пример: в хэндлерах используются все keyboard-ы, которые
прописаны в inline.py

3. Пакет validators содержит различные валидаторы для обработки данных, поступающих от заказчика
и исполнителя во время работы цепочки хэндлеров (при создании заказа или при регистрации исполнителя)
    Валидаторы для заказа:
        Функция validate_numeric_field(), которая обрабатывает целочисенные и вещественные данные 
        (кол-во товара и его габариты в handlers.client.py)
        Функция validate_string_field(), которая обрабатывает выбор материала или цвета
        Функция validate_post_processing(), которая обрабатывает выбор пост обработки (да/нет)
    Валидаторы для регистрации исполнителя: 
        Обработчик типа занятости (3 выбора)
        Обработчик правильности введённого ФИО или компании в зависимости от типа занятости
        Обработчик ИНН (10 или 12 цифр)

4. Токен тг бота подгружается из файла .env и библиотеку dotenv()

5. Файл message.py структурирован по категориям сообщений

6. Файл __init__.py базы данных переделан: убраны все лишние функции, которые обавляют каждый из параметров
в БД, вместо этого добавлены две важные функции: save_orders_info() и save_seller_info(), которые
вызываются в конце работы цепочек хэндлеров в файле client.py и seller.py. Эти функции отправляют
один большой запрос на сохранение всех провалидированных данных

7. Структура таблиц seller и orders переделанна: в них были добавлены основные атрибуты, которые
соответствуют ТЗ из miro. БД заполняется в конце работы цепочек хэндлеров, если все данные корректны
и пользователь нажал на соответствующую кнопку о принятии заказа или о завершении регистрации

8. В файле urils.notify_admins.py добавил регистраторы хэндлеров, чтобы они все корректно работыли из
разных файлов